<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" type="image/x-icon" href="IQSpaces_fabicon_v3.ico">
    <title>Info Pacientes</title>
    <link rel="stylesheet" href="css/estilo.css">
    <!--<script src="js/scripts.js"></script>-->
    <script src="js/md5.js"></script>
    <!--<script type="text/javascript" src="js/App.js"> </script>-->
    <!--<script src="js/App.js"> </script>-->
</head>

<body>
    <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjAi9Vh52hPwNrUWCLpU6BMtzX6qkGbyMBXQ2QVoiLNtYLxZ7msK6DfPbP-oMOtQjP9POFNLZaqUS1XyJXUodbPwQ_KADyZfHRD2yhymjIM2I1M4bsOjFAPh4yC5YWTkFzyNLto4P9_oGKWGaxeEXZr6ftDQUGLQob9SYFuo8RYk_5onGE7o8vYSAhO/w633-h245/IQ_Spaces_Def_prueba%20cambio%20colores.png"
        alt="Logo" title="Foto tomada por Jairo" width="250" height="100" />

    <h1>Sistema de Cargue de Información - Etiquetas electrónicas</h1>
    <br />
    <h2>Información del Paciente</h2>
    <br />
    <form action="" id="transationform">
        <div>
            <label for="itemBarCode">Habitación Asignada</label>
            <select name="itemBarCode" id="itemBarCode">
                <option value="101A">101A</option>
                <option value="101B">101B</option>
                <option value="201A">201A</option>
                <option value="201B">201B</option>
            </select>
            <div>
                <label for="itemName">Nombre Completo:</label>
                <input type="text" name="itemName" id="itemName" placeholder="Nombres y Apellidos" required size="30"
                    maxlength="30" />
                <span class="validity"></span>
            </div>
        </div>
        <div>
            <label for="goodsNo">No. documento Identidad:</label>
            <input type="text" name="goodsNo" id="goodsNo" placeholder="solo números" required size="10" minlength="6"
                maxlength="10" />
            <span class="validity"></span>
        </div>
        <div>
            <label for="stock">Brazalete:</label>
            <input type="text" name="stock" id="stock" placeholder="solo números" required size="9" minlength="9" />
            <span class="validity"></span>
        </div>



        <div>
            <label>Fecha Nacimiento:</label>
            <input type="date" name="manufacture" id="manufacture" />
        </div>
        <div>
            <label for="storageCondition">Edad:</label>
            <input type="text" name="storageCondition" id="storageCondition" placeholder="solo números" required
                size="3" minlength="1" maxlength="3" />
            <span class="validity"></span>
        </div>
        <div>
            <label for="eatMethod">Sexo</label>
            <select name="eatMethod" id="eatMethod">
                <option value="Masculino">Masculino</option>
                <option value="Femenino">Femenino</option>
            </select>
        </div>
        <div>
            <label for="itemProductionPlace">Grupo y RH</label>
            <select name="itemProductionPlace" id="itemProductionPlace">
                <option value="A+">A+</option>
                <option value="A-">A-</option>
                <option value="B+">B+</option>
                <option value="B-">B-</option>
                <option value="AB+">AB+</option>
                <option value="AB-">AB-</option>
                <option value="O+">O+</option>
                <option value="O-">O-</option>
            </select>
        </div>
        <div>
            <label for="license">EPS</label>
            <input type="text" name="license" id="license" / placeholder="digite información">
        </div>
        <div>
            <label for="specifications">Alergias</label>
            <input type="text" name="specifications" id="specifications" / placeholder="digite información">
        </div>
        <div>
            <label for="grade">Riesgo de Caídas</label>
            <select name="grade" id="grade">
                <option value="Bajo">Bajo</option>
                <option value="Medio">Medio</option>
                <option value="Medio">Alto</option>
            </select>
        </div>
        <div>
            <label for="company">Doctor Tratante</label>
            <input type="text" name="company" id="company" placeholder="Primer Nombre y Apellido" required size="30"
                maxlength="30" />
        </div>
        <div>
            <label for="itemQrCode">Link Historia clinica</label>
            <input type="text" name="itemQrCode" id="itemQrCode" placeholder="pagina web" size="60" maxlength="30" />
        </div>
        <div>
            <label for="mixture">Fecha de Ingreso</label>
            <input type="date" name="mixture" id="mixture" placeholder="aaaa-mm-dd" />
        </div>
        <div>
            <label for="itemBaseUnit">Hora de Ingreso</label>
            <input type="time" name="itemBaseUnit" id="itemBaseUnit" />
        </div>


        <div>
            <br />
            <button type="button" onclick="cargar()">Cargue/Edición en Base de Datos</button>
            <!--<button>Cargue/Edición en Base de Datos</button>-->
            <!--<br/>
        <button onclick="limpiar()">Limpiar Campos</button>-->
            <br />
        </div>
        <br />
    </form>
    <br />
    <br />
    <div class="formatotabla">
        <table id="transactionTable">
            <tr>
                <th>
                    Hab. Asignada
                </th>
                <th>
                    Nombre Completo
                </th>
                <th>
                    # Documento
                </th>
                <th>
                    Brazalete
                </th>
                <th>
                    Fecha Nacimiento
                </th>
                <th>
                    Edad
                </th>
                <th>
                    Sexo
                </th>
                <th>
                    Grupo y RH
                </th>
                <th>
                    EPS
                </th>
                <th>
                    Alergias
                </th>
                <th>
                    Riesgo de Caidas
                </th>
                <th>
                    Doctor Tratante
                </th>
                <th>
                    Link historia Clínica
                </th>
                <th>
                    Fecha de Ingreso
                </th>
                <th>
                    Hora de Ingreso
                </th>

                <th>
                    Categoria
                </th>
                <th>
                    Fecha envio Info
                </th>
            </tr>
            <!--<tr>
                <td>123456789</td>
                <td>Jairo Massard</td>
                <td>72004236</td>
                <td>100000011</td>
                <td>1978-07-08</td>
                <td>43</td>
                <td>Masculino</td>
                <td>A+</td>
                <td>Ninguna</td>
                <td>Bajo</td>
                <td>Adriana Pardo</td>
                <td>2022-05-23</td>
                <td>10:00AM</td>
                <td>http://www.iqspaces.com.co</td>
                <td>101A</td>
            </tr>-->

        </table>

    </div>

    <script>

        //CALCULO FORMATO FECHA

        var fecha = new Date();
        fecha.setHours(fecha.getHours() + 13);

        //document.getElementById("demo").innerHTML = fecha;

        var hoy = fecha.getDate();
        var mesActual = fecha.getMonth() + 1;
        //const hora = fecha.getHours();
        const year = fecha.getFullYear();
        //const year2 = fecha.

        if (mesActual < 10) mesActual = '0' + mesActual;
        if (hoy < 10) hoy = '0' + hoy;

        const formatofecha = year + "-" + mesActual + "-" + hoy;
        //document.getElementById("demo").innerHTML = formatofecha;


        //SCRIPTS de la pagina

        const form = document.getElementById("transationform");
        //console.log(form)

        function cargar() {
            alert("Envio exitoso de formulario");
            //event.preventDefault();
            let transactionFormData = new FormData(form);
            let transactionObj = convertFormDataToTransactionObj(transactionFormData);
            //console.log(transactionObj);
            //console.log(transactionObj);
            saveTransactionObj(transactionObj);
            insertRowInTransactionTable(transactionObj);
            EnviarYalaInfo(transactionObj);
            //form.reset()
        }

        document.addEventListener("DOMContentloaded", function (event1) {
            let transactionObjArr = [JSON.parse(localStorage.getItem("transactionData"))];
            transactionObjArr.forEach(
                function (arrayElement) {
                    insertRowInTransactionTable(arrayElement);
                    //console.log(arrayElement);
                    //console.log("Se insertan elementos desde localStorage")
                }
            )
        }
        )

        function convertFormDataToTransactionObj(transactionFormData) {
            let itemBarCode = transactionFormData.get("itemBarCode");
            let itemName = transactionFormData.get("itemName");
            let merchantGoodsId = itemBarCode;
            let merchantGoodsCategoryId = itemBarCode;
            let goodsNo = transactionFormData.get("goodsNo");
            let stock = transactionFormData.get("stock");
            let manufacture = transactionFormData.get("manufacture");
            let storageCondition = transactionFormData.get("storageCondition");
            let eatMethod = transactionFormData.get("eatMethod");
            let itemProductionPlace = transactionFormData.get("itemProductionPlace");
            let license = transactionFormData.get("license");
            let specifications = transactionFormData.get("specifications");
            let grade = transactionFormData.get("grade");
            let company = transactionFormData.get("company");
            let itemQrCode = transactionFormData.get("itemQrCode");
            let mixture = transactionFormData.get("mixture");
            let itemBaseUnit = transactionFormData.get("itemBaseUnit");
            let categoryName = "Paciente";
            return {
                "itemBarCode": itemBarCode,
                "itemName": itemName,
                "merchantGoodsId": merchantGoodsId,
                "merchantGoodsCategoryId": merchantGoodsCategoryId,
                "goodsNo": goodsNo,
                "stock": stock,
                "manufacture": manufacture,
                "storageCondition": storageCondition,
                "eatMethod": eatMethod,
                "itemProductionPlace": itemProductionPlace,
                "license": license,
                "specifications": specifications,
                "grade": grade,
                "company": company,
                "itemQrCode": itemQrCode,
                "mixture": mixture,
                "itemBaseUnit": itemBaseUnit,
                "categoryName": categoryName
            }
        }


        function insertRowInTransactionTable(transactionObj) {
            let transactionTableRef = document.getElementById("transactionTable");

            let newtransactionRowRef = transactionTableRef.insertRow(-1);

            let newTypeCellRef = newtransactionRowRef.insertCell(0);
            newTypeCellRef.textContent = transactionObj["itemBarCode"];

            newTypeCellRef = newtransactionRowRef.insertCell(1);
            newTypeCellRef.textContent = transactionObj["itemName"];

            newTypeCellRef = newtransactionRowRef.insertCell(2);
            newTypeCellRef.textContent = transactionObj["goodsNo"];

            newTypeCellRef = newtransactionRowRef.insertCell(3);
            newTypeCellRef.textContent = transactionObj["stock"];

            newTypeCellRef = newtransactionRowRef.insertCell(4);
            newTypeCellRef.textContent = transactionObj["manufacture"];

            newTypeCellRef = newtransactionRowRef.insertCell(5);
            newTypeCellRef.textContent = transactionObj["storageCondition"];

            newTypeCellRef = newtransactionRowRef.insertCell(6);
            newTypeCellRef.textContent = transactionObj["eatMethod"];

            newTypeCellRef = newtransactionRowRef.insertCell(7);
            newTypeCellRef.textContent = transactionObj["itemProductionPlace"];

            newTypeCellRef = newtransactionRowRef.insertCell(8);
            newTypeCellRef.textContent = transactionObj["license"];

            newTypeCellRef = newtransactionRowRef.insertCell(9);
            newTypeCellRef.textContent = transactionObj["specifications"];

            newTypeCellRef = newtransactionRowRef.insertCell(10);
            newTypeCellRef.textContent = transactionObj["grade"];

            newTypeCellRef = newtransactionRowRef.insertCell(11);
            newTypeCellRef.textContent = transactionObj["company"];

            newTypeCellRef = newtransactionRowRef.insertCell(12);
            newTypeCellRef.textContent = transactionObj["itemQrCode"];

            newTypeCellRef = newtransactionRowRef.insertCell(13);
            newTypeCellRef.textContent = transactionObj["mixture"];

            newTypeCellRef = newtransactionRowRef.insertCell(14);
            newTypeCellRef.textContent = transactionObj["itemBaseUnit"];

            newTypeCellRef = newtransactionRowRef.insertCell(15);
            newTypeCellRef.textContent = transactionObj["categoryName"];

            newTypeCellRef = newtransactionRowRef.insertCell(16);
            newTypeCellRef.textContent = new Date();

        }

        function saveTransactionObj(transactionObj) {
            //Jalo lo que hay en el Local Storage, lo convierto a Variable y lo asigno a un array de transacciones
            let myTransactionArray = [JSON.parse(localStorage.getItem("transactionData"))] || [];
            myTransactionArray.push(transactionObj);
            //convierto mi Array de transacciones a JSON
            let transactionArrayJSON = JSON.stringify(myTransactionArray);
            //Guardo mi array de transacciones en formato JSON en Local storage
            //localStorage.setItem("transactionData", transactionArrayJSON)

        }

        //function limpiar() {
        //    form.reset()
        //}

        function EnviarYalaInfo(transactionObj) {
            var myHeaders = new Headers();
            myHeaders.append("veryText", hash1);
            myHeaders.append("merchantCode", "MC1220");
            myHeaders.append("type", "1");
            myHeaders.append("content-type", "application/json");

            var raw = JSON.stringify([transactionObj]);
            //console.log(raw)

            var requestOptions = {
                method: 'POST',
                headers: myHeaders,
                body: raw,
                redirect: 'follow'
            };

            fetch("https://sg.yalabi.net/open/saveOrGoods", requestOptions)
                .then(response => response.json())
                .then(result => console.log(result))
                .catch(error => console.log('error', error));

        };


        //function buscar(){
        //var myHeaders = new Headers();
        //myHeaders.append("veryText", "a9e787bcbc24f5a71019969090387ff9");
        //myHeaders.append("merchantCode", "MC1220");
        //myHeaders.append("content-type", "application/json");

        //var raw = JSON.stringify({
        //"pageSize": 30
        //});

        //var requestOptions = {
        //method: 'POST',
        //headers: myHeaders,
        //body: raw,
        //redirect: 'follow'
        //};

        //fetch("https://sg.yalabi.net/open/getGoodsList", requestOptions)
        //.then(response => response.json())
        //.then(result => console.log(result.data.list))
        //.catch(error => console.log('error', error));
        //}


        let hash1 = md5("83C3A53C05553cb" + formatofecha);
        console.log(hash1)

    </script>


</body>

</html>
